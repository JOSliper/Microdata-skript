//skript til Pandaseminaret på Røros 12.11.2025
//basert på skirptet brukt til denne analysen: https://trondelagitall.no/artikkel/skatt-og-offentlige-overforinger-hvilke-aldersgrupper-mottar-mest-og-hvilke-bidrar-mest

require no.ssb.fdb:46 as fdb 
create-dataset pop

//bruker befolkningen per 1.1.2024 
import fdb/BEFOLKNING_KOMMNR_FORMELL 2024-01-01 as bosted
generate fylke = substr(bosted,1,2)
generate kommnr = substr(bosted,1,4)

generate Trønder = 'ikke trønder'
replace Trønder = 'Trønder' if fylke == '50'


import fdb/BEFOLKNING_KJOENN as kjønn

//henter alder - bruker år -1 for å sikre at aldersfordelt befolkning samsvarere med tallene i statistikkbanken 
import fdb/BEFOLKNING_FOEDSELS_AAR_MND as faarmnd
generate alder = 2023 - int(faarmnd/100)

//lager aldersgrupper 5 årsgrupper
generate aldersgruppe = '0'
replace aldersgruppe = '0-4 år' if alder >= 0
replace aldersgruppe = '5-9 år' if alder >= 5
replace aldersgruppe = '10-14 år' if alder >= 10
replace aldersgruppe = '15-19 år' if alder >= 15
replace aldersgruppe = '20-24 år' if alder >= 20
replace aldersgruppe = '25-29 år' if alder >= 25
replace aldersgruppe = '30-34 år' if alder >= 30
replace aldersgruppe = '35-39 år' if alder >= 35
replace aldersgruppe = '40-44 år' if alder >= 40
replace aldersgruppe = '45-49 år' if alder >= 45
replace aldersgruppe = '50-54 år' if alder >= 50
replace aldersgruppe = '55-59 år' if alder >= 55
replace aldersgruppe = '60-64 år' if alder >= 60
replace aldersgruppe = '65-69 år' if alder >= 65
replace aldersgruppe = '70-74 år' if alder >= 70
replace aldersgruppe = '75-79 år' if alder >= 75
replace aldersgruppe = '80-84 år' if alder >= 80
replace aldersgruppe = '85-89 år' if alder >= 85
replace aldersgruppe = '90 eller eldre år' if alder >= 90
replace aldersgruppe = 'Ukjent alder' if sysmiss(faarmnd)

//begrenser populasjonen til personer over 20 år
keep if alder >= 20
//keep if alder < 60

//legger til skatt i 2023
import fdb/SKATT_FASTSATT_SKATT 2023-12-31 as skatt
histogram skatt
summarize skatt
tabulate  aldersgruppe kjønn, summarize(skatt)
tabulate  aldersgruppe kjønn if fylke =='50' , summarize(skatt) 

//setter missing til 0 
replace skatt = 0 if sysmiss(skatt)
histogram skatt
summarize skatt
tabulate aldersgruppe kjønn, summarize(skatt)
tabulate aldersgruppe kjønn if fylke =='50' , summarize(skatt)

tabulate aldersgruppe Trønder, summarize(skatt)
barchart (mean) skatt if fylke =='50', over(aldersgruppe) 

//legger til overføringer i 2023
import fdb/INNTEKT_OVERFOR 2023-12-31 as overføring
histogram overføring
summarize overføring
tabulate aldersgruppe kjønn, summarize(overføring)
tabulate aldersgruppe kjønn if fylke =='50' , summarize(overføring)

//to variabler på overføringer - test på den andre variablene for å se hva som er forskjellen mellom de to 
import fdb/INNTEKT_WOVERFOR 2023-12-31 as overføring2
histogram overføring2
summarize overføring2
tabulate aldersgruppe kjønn if fylke =='50' , summarize(overføring2)

hexbin overføring overføring2

//velger å bruke INNTEKT_OVERFOR videre 

//setter missing til 0 
replace overføring = 0 if sysmiss(overføring)
histogram overføring
summarize overføring
tabulate aldersgruppe kjønn, summarize(overføring)
tabulate aldersgruppe kjønn if fylke =='50' , summarize(overføring)

tabulate aldersgruppe Trønder, summarize(overføring)
barchart (mean) overføring if fylke =='50', over(aldersgruppe) 

hexbin overføring skatt

//Lager nettooverføring
generate nettooverføring = skatt -overføring

histogram nettooverføring
summarize nettooverføring
tabulate aldersgruppe kjønn, summarize(nettooverføring)
tabulate aldersgruppe kjønn if fylke =='50' , summarize(nettooverføring)

tabulate aldersgruppe fylke, summarize(nettooverføring)

boxplot nettooverføring if fylke =='50', over(aldersgruppe)
boxplot nettooverføring , over(fylke)


tabulate bosted, summarize(nettooverføring)

generate netto = 'Negativ'
replace netto = 'Positiv' if nettooverføring > 0

tabulate bosted netto, missing

//beholder kun trøndelag
keep if fylke =='50'

tabulate aldersgruppe netto, missing rowpct freq
tabulate aldersgruppe netto, summarize(overføring)
tabulate aldersgruppe netto, summarize(skatt)
tabulate aldersgruppe netto, summarize(nettooverføring)

//antaLL med og uten overføring 
generate mottar = 'Mottar'
replace mottar = 'Mottar ikke' if overføring ==0

tabulate aldersgruppe mottar, missing rowpct freq
tabulate aldersgruppe mottar, summarize(overføring)
tabulate aldersgruppe mottar, summarize(skatt)
tabulate aldersgruppe mottar, summarize(nettooverføring)


// Legger til Innvandringskategori
import fdb/BEFOLKNING_INVKAT as kat
generate Innvandringskategori = '3'
replace Innvandringskategori = '1' if kat == 'B'
replace Innvandringskategori = '2' if kat == 'C'
replace Innvandringskategori = 'Ukjent ' if sysmiss(kat)
define-labels Innvandringskategoritxt '1' 'Innvandrere' '2' 'Norskfødt med innvandrerforeldre' '3' 'Øvrig befolkning'
assign-labels Innvandringskategori Innvandringskategoritxt

tabulate aldersgruppe Innvandringskategori, summarize(skatt)
tabulate aldersgruppe Innvandringskategori, summarize(overføring)
tabulate aldersgruppe Innvandringskategori, summarize(nettooverføring)
tabulate aldersgruppe Innvandringskategori, summarize(nettooverføring) freq

//legger til Innvandringsgrunn
import fdb/BEFOLKNING_INNGRUNN1 as grunn

tabulate aldersgruppe grunn if Innvandringskategori == '1', summarize(nettooverføring)
tabulate aldersgruppe grunn if Innvandringskategori == '1', summarize(nettooverføring) freq

//legger til utdanningsnivå
import fdb/NUDB_BU 2023-08-01 as utd
generate utd1 = substr(utd,1,1)
//lager kategorier
generate utdniv = '9'
replace utdniv = '1' if utd1 == '1' | utd1 == '2'
replace utdniv = '2' if utd1 == '3' | utd1 == '4' | utd1 == '5'
replace utdniv = '3' if utd1 == '6'
replace utdniv = '4' if utd1 == '7' | utd1 == '8' 
define-labels utdnivtxt '1' 'Grunnskolenivå' '2'  'Videregående grunnopplæring' '3' 'Universitets og høgskolenivå kort' '4' 'Universitets og høgskolenivå lang' '9' 'Uoppgitt el ingen utdanning'
assign-labels utdniv utdnivtxt

tabulate aldersgruppe utdniv, summarize(skatt)
tabulate aldersgruppe utdniv, summarize(overføring)
tabulate aldersgruppe utdniv, summarize(nettooverføring)

tabulate Innvandringskategori utdniv, summarize(nettooverføring)

tabulate bosted netto, summarize(nettooverføring)

tabulate aldersgruppe netto, rowpct

tabulate alder utdniv, summarize(nettooverføring)

regress nettooverføring i.kjønn i.utdniv i.Innvandringskategori  if alder >67
coefplot regress nettooverføring  i.kjønn  i.utdniv i.Innvandringskategori if alder >67

regress nettooverføring i.kjønn i.utdniv i.Innvandringskategori  if alder <67
coefplot regress nettooverføring  i.kjønn  i.utdniv i.Innvandringskategori if alder <67

tabulate kjønn, summarize(nettooverføring)


//legger til tilknyttning til arbeidsliv
//henter Prioritert arbeidsstyrkestatus
import fdb/ARBSTATUS_PERS_STATUS8 2023-11-16  as status
generate status4 = substr(status,1,4)
tabulate status4, missing
//lager nivå2
generate Nivå_2 = 'Missing'
replace Nivå_2 = '1 - Sysselsatte' if status4 == '0808' | status4 == '0816' |status4 == '0824' | status4 == '0832' | status4 == '1608'
replace Nivå_2 = '2 - Registrerte arbeidsledige' if status4 == '2408'
replace Nivå_2 = '3 - Deltakere på arbeidsmarkedstiltak' if status4 == '3208' |status4 == '3216' | status4 == '3232' | status4 == '4816' | status4 == '3240'
replace Nivå_2 = '4 - Under ordinær utdanning' if status4 == '4008' 
replace Nivå_2 = '5 - Mottakere av arbeidsavklarings-penger/uføretrygd' if status4 == '4848' | status4 == '4832' | status4 == '4856' | status4 == '4864' 
replace Nivå_2 = '6 - Mottakere av AFP/alderspensjon' if status4 == '5616' |status4 == '5632'

//replace Nivå_2 = '7 - Andre' if status4 == '3224' | status4 == '4808'| status4 == '5608' | status4 == '5624' | status4 == '5640' | status4 == '6408' | status4 == '6416' | status4 == '6424' | status4 == '6432'
//replace Nivå_2 = '8 - Ukjent' if status4 == '7208' 

replace Nivå_2 = '7 - Andre/ukjent' if status4 == '3224' | status4 == '4808'| status4 == '5608' | status4 == '5624' | status4 == '5640' | status4 == '6408' | status4 == '6416' | status4 == '6424' | status4 == '6432' |status4 == '7208' 

tabulate Nivå_2, missing
generate Nivå_2_tall = substr(Nivå_2,1,1)

//lager nivå 4/NEETs
generate Nivå_4 = 'Missing'
replace Nivå_4 = '1 - I arbeid, under utdanning eller på arbeidsmarkedstiltak' if Nivå_2_tall == '1' | Nivå_2_tall == '3'  | Nivå_2_tall == '4'
replace Nivå_4 = '2 - Utenfor arbeid, utdanning og arbeidsmarkedstiltak' if Nivå_2_tall == '2' | Nivå_2_tall == '5' | Nivå_2_tall == '6' | Nivå_2_tall == '7'| Nivå_2_tall == '8'


tabulate aldersgruppe Nivå_2, summarize(nettooverføring)

tabulate Nivå_2 kjønn , summarize(nettooverføring)
tabulate Nivå_2 kjønn if alder <67 , summarize(nettooverføring)
