require no.ssb.fdb:39 as fdb 
create-dataset pop

//henter befolkningen i Trøndelag 
import fdb/BEFOLKNING_KOMMNR_FORMELL 2020-01-01  as bosted
generate fylke = substr(bosted,1,2)
generate kommnr = substr(bosted,1,4)
keep if fylke == '50'| fylke == '16'| fylke  == '17'  | kommnr  == '1567'| kommnr  == '1571'

//henter invandringsgrunn 
import fdb/BEFOLKNING_INNGRUNN1  as grunn
tabulate  grunn 

keep if grunn == "FLU"

//henter første oppholdsdato
import fdb/BEFOLKNING_FORSTDATO  as FORSTDATO
generate FORSTår =  substr(FORSTDATO,1,4)

tabulate FORSTår, missing

destring FORSTår
generate botid = 2020 - FORSTår

//beholder kun de med botid på 4 år eller mindre
keep if botid <= 4

tabulate bosted botid, missing

//henter bosted 2025
import fdb/BEFOLKNING_KOMMNR_FORMELL 2025-01-01  as bosted2025
generate Fylke2025 = substr(bosted2025,1,2)

//henter befolkingststaus - merk kun 2024 
import fdb/BEFOLKNING_STATUSKODE 2024-01-01  as status

tabulate status, missing

tabulate bosted2025, missing


//legger til sentralitet i 2020
generate sentralitet2020 = substr(bosted,1,4)
recode sentralitet2020 ('0301' '3020' '3024' '3027' '3029' '3030' = '01' 'Sentralitet: 1 (925-1000)') ('1103' '1108' '3002' '3003' '3004' '3005' '3019' '3021' '3022' '3025' '3031' '3032' '3033' '3049' '3403' '3801' '3803' '4601' '5001' = '02' 'Sentralitet: 2 (870-924)') ('1106' '1120' '1121' '1122' '1124' '1127' '1507' '1804' '3001' '3006' '3007' '3014' '3015' '3016' '3017' '3018' '3023' '3026' '3028' '3034' '3035' '3036' '3038' '3047' '3048' '3053' '3054' '3401' '3405' '3407' '3411' '3412' '3413' '3420' '3443' '3446' '3802' '3804' '3805' '3806' '3807' '3811' '3813' '4202' '4203' '4204' '4215' '4627' '5031' '5035' '5401' = '03' 'Sentralitet: 3 (775-869)') ('1101' '1114' '1119' '1130' '1146' '1149' '1505' '1506' '1516' '1517' '1520' '1528' '1531' '1532' '1577' '1806' '1824' '1833' '1841' '1870' '3011' '3013' '3037' '3041' '3050' '3414' '3415' '3416' '3440' '3441' '3442' '3447' '3448' '3451' '3808' '3812' '3814' '3816' '3817' '4201' '4205' '4206' '4207' '4213' '4214' '4216' '4219' '4223' '4225' '4612' '4614' '4621' '4622' '4623' '4624' '4626' '4630' '4631' '4647' '5006' '5007' '5028' '5029' '5036' '5037' '5038' '5053' '5059' '5402' '5403' '5406' = '04' 'Sentralitet: 4 (670-774)') ('1111' '1112' '1135' '1145' '1160' '1515' '1525' '1535' '1539' '1547' '1554' '1557' '1560' '1563' '1566' '1579' '1813' '1820' '1840' '1860' '1865' '1866' '1868' '3012' '3039' '3040' '3042' '3043' '3044' '3045' '3046' '3051' '3417' '3418' '3419' '3421' '3422' '3427' '3428' '3430' '3435' '3436' '3437' '3438' '3439' '3449' '3450' '3452' '3453' '3815' '3818' '3819' '3820' '3821' '4211' '4212' '4217' '4218' '4226' '4227' '4228' '4602' '4611' '4613' '4615' '4617' '4618' '4625' '4628' '4632' '4640' '4643' '4649' '4650' '4651' '5021' '5022' '5025' '5027' '5032' '5034' '5045' '5047' '5054' '5055' '5057' '5061' '5405' '5411' '5416' '5418' '5419' '5421' '5428' '5437' '5444' = '05' 'Sentralitet: 5 (565-669)') ('1133' '1134' '1144' '1151' '1511' '1514' '1573' '1576' '1578' '1811' '1812' '1815' '1816' '1818' '1822' '1825' '1826' '1827' '1828' '1832' '1834' '1835' '1836' '1837' '1838' '1839' '1845' '1848' '1851' '1853' '1856' '1857' '1859' '1867' '1871' '1874' '1875' '3052' '3423' '3424' '3425' '3426' '3429' '3431' '3432' '3433' '3434' '3454' '3822' '3823' '3824' '3825' '4220' '4221' '4222' '4224' '4616' '4619' '4620' '4629' '4633' '4634' '4635' '4636' '4637' '4638' '4639' '4641' '4642' '4644' '4645' '4646' '4648' '5014' '5020' '5026' '5033' '5041' '5042' '5043' '5044' '5046' '5049' '5052' '5056' '5058' '5060' '5404' '5412' '5413' '5414' '5415' '5417' '5420' '5422' '5423' '5424' '5425' '5426' '5427' '5429' '5430' '5432' '5433' '5434' '5435' '5436' '5438' '5439' '5440' '5441' '5442' '5443' = '06' 'Sentralitet: 6 (0-564)')

tabulate bosted sentralitet2020, missing


//legger til sentralitet på 2024 kommmuner 
generate sentralitet2025 = substr(bosted2025,1,4)
recode sentralitet2025 ('0301''3201''3205' '3222' '3224'= '01' 'Sentralitet: 1 (925-1000) ') ('1103' '1108' '1124' '3103' '3105' '3107' '3203''3207' '3209' '3214' '3216'' 3218' '3230' '3232' '3301' '3312' '3403' '3901' '3905' '4601''5001' = '02' 'Sentralitet: 2 (870-924)') ('1106' '1120' '1121''1122' '1127' '1130''1508''1804''3101''3112''3114''3116''3118''3120''3212''3220''3226''3228''3234''3236''3238''3240''3303''3305''3310''3314''3316''3401''3405''3407''3411''3412''3413''3415''3420''3443''3446''3903''3907''3909''3911''4001''4003''4012''4202''4203''4204''4215''4223''4627''5028''5031''5035''5501'= '03' 'Sentralitet: 3 (775-869)')('1101' '1114''1119'' 1146''1149''1505''1506' '1516''1517''1520''1528''1531' '1532' '1577' '1806' '1824''1833''1841''1870''3110' '3122' '3242' '3324''3334' '3414''3416''3440''3441''3442''3447' '3448''3451''4005''4010''4014''4018''4020''4201''4205''4206' '4207''4213''4214' '4216' '4219'' 4225' '4612''4614''4621''4622''4623''4624''4626''4630' '4631''5006''5007''5029' '5037' '5038' '5053' '5059' '5503'' 5601''5603'= '04' 'Sentralitet: 4 (670-774)') ('1111''1112''1133''1135''1145''1160' '1515''1525''1535''1539' '1547''1554''1557''1560' '1563''1566''1579''1580''1813' '1820''1832''1840''1860''1865''1866''1868' '3124''3318''3320''3322''3326''3328''3330''3332''3336''3417''3418''3419''3421''3422''3426''3427''3428''3435''3436''3437''3438''3439''3449''3450''3452''3453''4016''4022''4024''4026''4028''4211''4212''4217''4218''4226''4227''4228''4602''4611''4613''4615''4616''4617''4618''4625''4628''4632''4640''4642''4643''4644''4647''4649''4650''4651''5021''5022''5025''5027''5032''5034''5036''5045''5047''5054''5055''5057''5060''5061''5510''5520''5524''5526''5530''5544''5605''5607'= '05' 'Sentralitet: 5 (565-669)')('1134''1144''1151''1511''1514''1573' '1576''1578''1811''1812''1815''1816''1818''1822' '1825''1826''1827''1828' '1834''1835''1836''1837''1838' '1839''1845''1848''1851''1853''1856''1857''1859''1867''1871''1874''1875''3338''3423''3424''3425''3429''3430''3431''3432''3433''3434''3454''4030''4032''4034''4036''4220''4221''4222''4224''4619''4620''4629''4633''4634''4635''4636''4637''4638''4639''4641''4645''4646''4648''5014''5020''5026''5033''5041''5042''5043''5044''5046''5049''5052''5056''5058''5512''5514''5516''5518''5522''5528''5532''5534''5536''5538''5540''5542''5546''5610''5612''5614''5616''5618''5620''5622''5624''5626''5628''5630''5632''5634''5636' = '06' 'Sentralitet: 6 (0-564)')


tabulate bosted2025 sentralitet2025, missing

tabulate sentralitet2025 sentralitet2020, missing


//lager grupper
generate status2025 = '99'
replace status2025 = '3 Død eller utvandret' if sysmiss(bosted2025)

replace status2025 = '2.1 Andre deler av landet sentralitet 1' if sentralitet2025 == '01'
replace status2025 = '2.2 Andre deler av landet sentralitet 2' if sentralitet2025 == '02'
replace status2025 = '2.3 Andre deler av landet sentralitet 3' if sentralitet2025 == '03'
replace status2025 = '2.4 Andre deler av landet sentralitet 4' if  sentralitet2025 == '04'
replace status2025 = '2.5 Andre deler av landet sentralitet 5' if sentralitet2025 == '05'
replace status2025 = '2.6 Andre deler av landet sentralitetsentralitet 6' if sentralitet2025 == '06'

replace status2025 = '1.1 Trøndelag sentralitet 2' if Fylke2025 == '50'  & sentralitet2025 == '02'
replace status2025 = '1.2 Trøndelag sentralitet 3' if Fylke2025 == '50'  & sentralitet2025 == '03'
replace status2025 = '1.3 Trøndelag sentralitet 4' if Fylke2025 == '50'  & sentralitet2025 == '04'
replace status2025 = '1.4 Trøndelag sentralitet 5' if Fylke2025 == '50'  & sentralitet2025 == '05'
replace status2025 = '1.5 Trøndelag sentralitet 6' if Fylke2025 == '50'  & sentralitet2025 == '06'

replace status2025 = '1.0 Uendret kommune' if bosted2025 == bosted

tabulate status2025 sentralitet2020 , missing


//lager forenklede grupper
generate status2025forenklet  = '4'
replace status2025forenklet = '2 Annen kommune i Trøndelag' if Fylke2025 == '50' 
replace status2025forenklet = '1 Uendret kommune' if bosted2025 == bosted
replace status2025forenklet = '3 Utenfor Trøndelag' if Fylke2025 != '50' 
replace status2025forenklet = '98  Død eller utvandret' if sysmiss(bosted2025)


tabulate status2025forenklet sentralitet2020 , missing
