require no.ssb.fdb:21 as fdb
create-dataset Dataset

//henter personer som bodde  i Trøndelag når de var 16 år
import fdb/NUDB_KOMM_16 as bosted16
generate fylke = substr(bosted16,1,2)
generate kommnr = substr(bosted16,1,4)
keep if fylke == '50'| fylke == '16'| fylke  == '17' | kommnr  == '1567'| kommnr  == '1571' 

// Legger til kjønn
import fdb/BEFOLKNING_KJOENN as kjønn

//henter Årstall første gang registrert i videregående utdanning
import fdb/NUDB_AAR_NY_I_VID_UTD as  var1
generate Startår_VGS = substr(var1,1,4)
destring Startår_VGS

tabulate Startår_VGS  kjønn if Startår_VGS >= 2010, missing

//legger til utdanningsnivå
import fdb/NUDB_BU 2021-08-01 as utd
generate utd1 = substr(utd,1,1)
//lager kategorier
generate utdniv = '1'
replace utdniv = '2' if utd1 == '3' | utd1 == '4' | utd1 == '5'
replace utdniv = '3' if utd1 == '6' | utd1 == '7' | utd1 == '8' 
define-labels utdnivtxt '2'  'Videregående grunnopplæring' '3' 'Universitets og høgskolenivå'  '1' 'ikke fullført videregående'
assign-labels utdniv utdnivtxt

tabulate Startår_VGS utdniv if Startår_VGS >= 2000, missing rowpct freq 

keep if Startår_VGS == 2015
tabulate utdniv kjønn, missing colpct freq

//Henter personer som tar utdanning per 1. oktober i år x, og kobler dette på persondatasettet. 
create-dataset kursdata
import fdb/NUDB_KURS_NUS 2015-10-01 as kurstype
import fdb/NUDB_KURS_FNR as fnr
tabulate kurstype
//beholder de som er i videregående utdanning per 1. oktober i år x, - tenker å bruke denne for å skille mellom de som gikk allmen/yrkesfag 
destring kurstype
keep if kurstype >= 301106 & kurstype < 500000
tabulate kurstype

//lager allmen /ikke allmen
generate kurstype2 = substr(kurstype,1,2)
generate kurstype3 = substr(kurstype,1,3)
generate  allmen = 'Nei'
//ta utsjekk om 32-33 og 42-43 skal være med eller ikke
replace allmen = 'ja' if kurstype2 == '30' | kurstype3 == '315' | kurstype2 == '33' | kurstype2 == '40' | kurstype3 == '415' 

//FILLTER ALLMEN
//keep if allmen == 'ja'

collapse (count) kurstype, by(fnr)
rename kurstype ant_kurs
merge ant_kurs into Dataset

use Dataset

//test antall videregående kurs vs Trøndere som startet VGS i år x
tabulate Startår_VGS ant_kurs, missing

keep if ant_kurs == 1 

//tabulerer utdanningsnivå på nytt
tabulate utdniv kjønn, missing colpct freq

//henter Årstall første gang fullført treårig utdanning 
import fdb/NUDB_AAR_FORSTE_FULLF_VS as  var2
generate Fullført_VGS = substr(var2,1,4)
destring Fullført_VGS
//keep if Fullørt_VGS> 2015 

tabulate  Startår_VGS Fullført_VGS, missing
tabulate Fullført_VGS kjønn, missing colpct freq
tabulate Fullført_VGS utdniv, missing colpct freq

//første gang fullført treårig utdanning under lov om videregående opplæring
import fdb/NUDB_AAR_FORSTE_FULLF_VS_LOV as var2_1
generate Fullført_VGS_1 = substr(var2_1,1,4)
destring Fullført_VGS_1

tabulate  Fullført_VGS_1 Fullført_VGS, missing

//henter fullføringsår på allemen fag og yrkesfag
import fdb/NUDB_AAR_FORSTE_FULLF_VSY as  var2_2
generate Fullført_VGS_Y = substr(var2_2,1,4)
destring Fullført_VGS_Y 

tabulate Fullført_VGS_Y, missing

import fdb/NUDB_AAR_FORSTE_FULLF_VSA as  var2_3
generate Fullført_VGS_A = substr(var2_3,1,4)
destring Fullført_VGS_A 

tabulate Fullført_VGS_A, missing
tabulate Fullført_VGS_Y Fullført_VGS_A, missing


import fdb/NUDB_SEMESTER_FFF_VS as semester
tabulate semester utdniv, missing colpct freq


//starter å ta ut data om hva de driver med nå...

//arbeidstatus
import fdb/REGSYS_ARB_ARBMARK_STATUS 2021-11-16 as yrkstat
tabulate yrkstat utdniv, missing colpct freq
tabulate yrkstat utdniv, missing rowpct freq

//henter arbeidstid
import fdb/REGSYS_ARB_ARBEIDSTID 2021-11-16 as atid
summarize atid  
histogram atid

tabulate yrkstat utdniv, summarize(atid)


//Gruppere atid i  intervaller
generate atidint = 'ikke lønnstaker'
replace atidint = '0-15' if atid > 0
replace atidint = '15-20' if atid > 15
replace atidint = '20-25' if atid > 20
replace atidint = '25-30' if atid > 25
replace atidint = '30-35' if atid > 30
replace atidint = '35-37.5' if atid > 35
replace atidint = 'Over 37.5' if atid > 37.50

tabulate atidint utdniv if yrkstat =='1', missing 

//legger til inntekt 
import fdb/INNTEKT_WSAMINNT 2021-12-31 as inntekt

summarize inntekt
tabulate  yrkstat utdniv, summarize(inntekt)

//henter yrke per 4. kvartal 2021
import fdb/REGSYS_ARB_YRKE_STYRK08 2021-11-16 as yrke

tabulate yrke utdniv if yrkstat =='1', missing

import fdb/UFOERP2011FDT_GRAD 2021-11-30 as grad
tabulate grad utdniv, missing colpct freq

import fdb/SOSHJLPZFDT_BIDB 2021-12-31 as sosialhjelp
summarize sosialhjelp
tabulate utdniv, summarize(sosialhjelp)

generate sosial = 'Nei'
replace sosial = 'ja' if sosialhjelp >= 1

tabulate utdniv sosial, missing
tabulate sosial grad, missing
tabulate utdniv sosial grad, missing
